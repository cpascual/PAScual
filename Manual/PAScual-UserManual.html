<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.4  (Win32)">
	<META NAME="AUTHOR" CONTENT="Carlos Pascual-Izarra">
	<META NAME="CREATED" CONTENT="20080519;15052400">
	<META NAME="CHANGEDBY" CONTENT="Carlos Pascual-Izarra">
	<META NAME="CHANGED" CONTENT="20080526;17574694">
	<META NAME="CHANGEDBY" CONTENT="Carlos Pascual-Izarra">
	<META NAME="CHANGEDBY" CONTENT="Carlos Pascual-Izarra">
	<STYLE TYPE="text/css">
	<!--
		@page { size: 21cm 29.7cm; margin: 2cm }
		P { margin-bottom: 0.21cm }
		H1 { margin-bottom: 0.21cm }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
		H1.cjk { font-family: "Arial Unicode MS"; font-size: 16pt }
		H1.ctl { font-family: "Tahoma"; font-size: 16pt }
		H2 { margin-bottom: 0.21cm }
		H2.western { font-family: "Arial", sans-serif; font-size: 14pt; font-style: italic }
		H2.cjk { font-family: "HG Mincho Light J"; font-size: 14pt; font-style: italic }
		H2.ctl { font-family: "Arial Unicode MS"; font-size: 14pt; font-style: italic }
		H3 { margin-bottom: 0.21cm }
		H3.western { font-family: "Arial", sans-serif }
		H3.cjk { font-family: "HG Mincho Light J" }
		H3.ctl { font-family: "Arial Unicode MS" }
		A:link { font-family: "Courier New", monospace }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-AU" DIR="LTR">
<H1 CLASS="western"><A NAME="1.PAScual User Manual|outline"></A>PAScual
User Manual</H1>
<P><BR><BR>
</P>
<P>Author: Carlos Pascual-Izarra</P>
<P>Last modified in <SDFIELD TYPE=DATETIME SDNUM="3081;3081;DD/MM/YY">26/05/08</SDFIELD></P>
<P>This manual is work in progress. The most recent version can be
found at:</P>
<P><A HREF="http://pascual.sourceforge.net/PAScual-UserManual.html">http://pascual.sourceforge.net/PAScual-UserManual.html</A></P>
<P><BR><BR>
</P>
<DIV ID="Table of Contents1" DIR="LTR">
	<DIV ID="Table of Contents1_Head" DIR="LTR">
		<P STYLE="margin-top: 0.42cm; margin-bottom: 0.5cm; page-break-after: avoid">
		<FONT FACE="Albany, sans-serif"><FONT SIZE=4 STYLE="font-size: 16pt"><B>Table
		of Contents</B></FONT></FONT></P>
	</DIV>
	<P STYLE="margin-bottom: 0cm"><A HREF="#1.PAScual User Manual|outline">PAScual
	User Manual</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.2.Introduction|outline">Introduction</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.3.Installation|outline">Installation</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.3.1.Prerequisites |outline">Prerequisites
	</A>
	</P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.3.2.Specific installation instructions for the different operative Systems:|outline">Specific
	installation instructions for the different operative Systems:</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.3.3.For Windows:|outline">For
	Windows:</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.3.4.For Linux:|outline">For
	Linux:</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.3.5.For Mac:|outline">For
	Mac:</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.4.Basics of the Graphical User Interface|outline">Basics
	of the Graphical User Interface</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.1.Quick-and-dirty guide:|outline">Quick-and-dirty
	guide:</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.2.The Parameters tab (to be written)|outline">The
	Parameters tab (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.3.The Fitting tab (to be written)|outline">The
	Fitting tab (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.4.The Results tab (to be written)|outline">The
	Results tab (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.5.The Output tab (to be written)|outline">The
	Output tab (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.6.Loading a spectrum (to be written)|outline">Loading
	a spectrum (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.7.Simulating a spectrum (to be written)|outline">Simulating
	a spectrum (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.8.Example 1: fitting a single spectrum. (to be written)|outline">Example
	1: fitting a single spectrum. (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.9.Example 2: Fitting a series of related spectra. (to be written)|outline">Example
	2: Fitting a series of related spectra. (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.4.10.Example 3: Use of common parameters. (to be written)|outline">Example
	3: Use of common parameters. (to be written)</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.5.Advanced: the text mode user interface.|outline">Advanced:
	the text mode user interface.</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.6.The mathematics|outline">The
	mathematics</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.6.1.Model (to be written)|outline">Model
	(to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.6.2.Local Fitting (to be written)|outline">Local
	Fitting (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.6.3.Simulated Annealing (to be written)|outline">Simulated
	Annealing (to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.6.4.MCMC-BI (to be written)|outline">MCMC-BI
	(to be written)</A></P>
	<P STYLE="margin-left: 1cm; margin-bottom: 0cm"><A HREF="#1.6.5.(Rectangular) Tao-Eldrup (to be written)|outline">(Rectangular)
	Tao-Eldrup (to be written)</A></P>
	<P STYLE="margin-left: 0.5cm; margin-bottom: 0cm"><A HREF="#1.7.Things still not implemented|outline">Things
	still not implemented</A></P>
</DIV>
<H2 CLASS="western"></H2>
<H2 CLASS="western"><A NAME="1.2.Introduction|outline"></A>Introduction</H2>
<P>PAScual is a program for analysing PALS spectra. 
</P>
<P>The analysis is done by fitting the spectra to a model.</P>
<P><BR><BR>
</P>
<P>PAScual is in some ways similar programs like LTv9 or PALSfit, but
it has some features that make it unique:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">It is free / open source software
	(GPL license). So you can see the code and adapt it to your needs.</P>
	<LI><P STYLE="margin-bottom: 0cm">It gives options for choosing the
	fitting method: other programs use only Levemberg-Marquardt
	algorithms for the fit. PAScual offers a global minimisation
	algorithm (Simulated annealing) as well.</P>
	<LI><P STYLE="margin-bottom: 0cm">It offers a powerful tool for
	characterising the uncertainties in the results: The Markov Chain
	Monte-Carlo Bayesian Inference algorithm.</P>
	<LI><P STYLE="margin-bottom: 0cm">It allows you to set limits to the
	fitting parameters</P>
	<LI><P STYLE="margin-bottom: 0cm">It has an intuitive and easy
	Graphical User Interface, but it can also be used in text mode or
	incorporated as a library into your own program.</P>
	<LI><P STYLE="margin-bottom: 0cm">It is written in Python, so it is
	multi-platform (runs on Linux, Windows and Mac systems)</P>
	<LI><P STYLE="margin-bottom: 0cm">...and many more as it will be
	shown in the rest of the manual</P>
</UL>
<P><BR><BR>
</P>
<H2 CLASS="western"><A NAME="1.3.Installation|outline"></A>Installation</H2>
<P>The easiest part of the installation isto install PAScual itself.
Simply download the zip file from <A HREF="http://pascual.sourceforge.net/">http://pascual.sourceforge.net</A>
and unzip it in any directory you want.</P>
<P><BR><BR>
</P>
<P><B>But</B> you must have a few things installed first. If you are
a Python user, some of them may already be installed in your
computer. If not, you will need to install them. These
&quot;prerequisites&quot; are listed in the next subsection.</P>
<H3 CLASS="western"><A NAME="1.3.1.Prerequisites |outline"></A>Prerequisites
</H3>
<P>Here is a list of packages that you need installed to use PAScual.
All of them are free software that can be freely downloaded..</P>
<P>General Installation instructions:</P>
<P>For running PAScual you need, at the very least:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Python &gt;=2.5</P>
	<LI><P STYLE="margin-bottom: 0cm">Numpy &gt;=1.0.3</P>
	<LI><P STYLE="margin-bottom: 0cm">scipy &gt;=0.5.2</P>
</UL>
<P><BR><BR>
</P>
<P>For using the GUI interface (which I bet you want), you need also:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Qt &gt;=4.2.3 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">PyQt &gt;= 4.2.3 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">pyQwt &gt;=5.0.1 
	</P>
</UL>
<P><BR><BR>
</P>
<P>For getting graphical output in the text mode interface, you need:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">matplotlib &gt;= 0.90.1</P>
</UL>
<P><BR><BR>
</P>
<P>If you work on text mode a lot, Using <A HREF="http://ipython.scipy.org/moin/FrontPage">IPython</A>
can be very convenient.</P>
<P><BR><BR>
</P>
<H3 CLASS="western"><A NAME="1.3.2.Specific installation instructions for the different operative Systems:|outline"></A>
Specific installation instructions for the different operative
Systems:</H3>
<H3 CLASS="western"><A NAME="1.3.3.For Windows:|outline"></A>For
Windows:</H3>
<P>This is a step-by-step guide that will allow most Windows users to
install the required packages for PAScual. It asumes a Windows XP (32
bit) machine. If your computer is different or have different
requirements, you may prefer to install a different set of packages
(or even compile them yourself from sources). If so, refer to the
requisites in the General Installation Instructions.</P>
<P><BR><BR>
</P>
<P>Install the following in the given order:</P>
<OL>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="http://www.python.org/ftp/python/2.5.2/python-2.5.2.msi">python-2.5.2.msi</A></P>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="http://prdownloads.sourceforge.net/numpy/numpy-1.0.4.win32-py2.5.msi?use_mirror=internap">numpy-1.0.4.win32-py2.5.msi</A>
		</P>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="http://prdownloads.sourceforge.net/scipy/scipy-0.6.0.win32-py2.5.exe?download">scipy-0.6.0.win32-py2.5.exe</A>
		</P>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="http://pascual.sourceforge.net/required/PyQt-Py2.5-gpl-4.3.3-2.exe">PyQt-Py2.5-gpl-4.3.3-2.exe</A>
	(This package includes Qt, PyQt and PyQwt. The newest version in the
	<A HREF="http://www.riverbankcomputing.com/software/pyqt/download">PyQt
	web page</A> does not include PyQwt, so I recommend to use this one
	instead)</P>
</OL>
<P><BR><BR>
</P>
<P>If you intend to work in text mode, I recommend you the following
too:</P>
<OL START=5>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="http://downloads.sourceforge.net/matplotlib/matplotlib-0.91.2.win32-py2.5.exe?modtime=1199628765&amp;big_mirror=0">matplotlib-0.91.2.win32-py2.5.exe</A>
	(Needed only for graphs support in the text interface)</P>
</OL>
<P>The above packages can be installed using the default options
(i.e. &quot;next&quot;, &quot;next&quot;, &quot;next&quot;...). 
</P>
<H3 CLASS="western"><A NAME="1.3.4.For Linux:|outline"></A>For Linux:</H3>
<P>Check the requirements in the &quot;prerrequisites&quot; section.
Each of these packages should be available in any decent GNU/Linux
distribution</P>
<H3 CLASS="western"><A NAME="1.3.5.For Mac:|outline"></A>For Mac:</H3>
<P>As far as I know, every package is available for Mac. I haven't
tested them myself. If you own a Mac and you install PAScual., please
report it so that I can fill this.</P>
<P><BR><BR>
</P>
<H2 CLASS="western"><A NAME="1.4.Basics of the Graphical User Interface|outline"></A>
Basics of the Graphical User Interface</H2>
<H3 CLASS="western"><A NAME="1.4.1.Quick-and-dirty guide:|outline"></A>
Quick-and-dirty guide:</H3>
<P>Here are some instructions I wrote in an email. I will polish
this, but for the moment it may help:</P>
<P><BR><BR>
</P>
<P>To use PAScual in graphic mode (recommended), launch PAScualGUI.py</P>
<P><BR><BR>
</P>
<P><BR><BR>
</P>
<P>Regarding to the use. I will put this in the manual ASAP, but here
are a few tips:</P>
<P>First of all: use the &quot;?&quot; button: by clicking it and
then on some elements of the window, you may get useful tips.</P>
<P><BR><BR>
</P>
<P>Here is a step-by-step guide to analyse a spectrum (or a set of
them) with the GUI interface:</P>
<P>1.-Launch PAScualGUI.py. You should get the main window of the
program.</P>
<P>2.-Load the spectra (File--&gt;Load spectra). You will see them
appearing in the &quot;spectra selection&quot; pane on the left. You
can select or unselect them using the green square to the left of the
name. The parameters will only be set for the spectra that are
selected.</P>
<P>3.-Set the Region of interest for the fit (you will be prompted
when loading). You can type the min and max channels manually or
click on the box and then on the graph. If you are using the example
data, you can leave it from 0 to 1024.</P>
<P>4.-fill the initial guesses for the parameters. Each parameter has
a green check icon on its right. Click on it after changing the
number to apply this value to every **selected** spectra.</P>
<P>The CPI_A_xxx.dat series is a series of artificially generated
spectra. The values used for generating them are:</P>
<P>For the CPI_A_xxx.dat spectra you can use the following:</P>
<P>channel width: 50ps</P>
<P>FWHM: 270</P>
<P>Background: 100 (you can either type it manually or use the
calculator button on its left to estimate the initial guess from the
spectrum)</P>
<P>offset: 20 (you can either type it manually or use the calculator
button on its left to calculate the initial guess from the spectrum)</P>
<P>3 components: (I am not totally sure about some values righ now,
but you can put anything )</P>
<P>lifetimes 125, 400, ~2000 ps 
</P>
<P>intensities: 15, 20, 65 % (but you don't really need to give any
initial guess for intensities, just leave the defaults)</P>
<P>5.- Make sure you have applied all the parameters. You can see
this by looking at the table in the &quot;spectra selection&quot;
pane. Everything should be green for the selected spectra (including
the name). Note that there is an &quot;Apply all&quot; button on the
right bottom corner. If you click on it, the current parameters will
be applied to every selected spectrum (it is like clicking all the
&quot;apply parameters&quot; together).</P>
<P>6.- Now you can go to the &quot;Fitting&quot; tab. On the right
you see two panes, one containing &quot;Commands&quot; and the other
containing &quot;Sets&quot;. In the &quot;sets&quot; You should see
one set for each spectrum you loaded (each set containing one
spectrum only). This is the case unless you chose a common
parameter...</P>
<P>The command table shows the commands that will be executed for
each set. You can change the commands manually or simply by choosing
a predefined fitting mode from a dropdown list just above (by
default, you will see &quot;LOCAL-connected&quot;. LOCAL-Connected
emulates the behaviour of LTv9. It means that the fit will use the
faster LOCAL algorithm and that the results from the previous fit
will be used for initialising the next fit.</P>
<P>7.-Just for the first test, you can leave things as they are and
click on the &quot;play&quot; button at the bottom right of this tab.
This should launch the fit. And you should see the progress bars
running. 
</P>
<P>8.-If everything went ok, you should see the results in the
&quot;Results&quot; tab. If the chi2 is in too bad values (maybe
infinite), the row should be red.</P>
<P>9.-Doubleclicking on any cell of the table should show (at the
bottom) the residuals of the fit for the spectrum represented in that
row.</P>
<P>10.-The &quot;Output tab&quot; logs (in text mode) all the
results. It is useful for troubleshooting. If you want to report
problems, you may want to copy and paste the contents of this window.</P>
<P><BR><BR>
</P>
<P>Finally, about the different Fitting modes available: there are
some predefined fitting modes. You can modify them or include your
own. They are simply a set of commands to be run for each set of
spectra.</P>
<P>The commands are:</P>
<P>SAVE: saves current value of the parameters (to be later read by
LOAD)</P>
<P>LOAD: loads previous results saved with SAVE. If SAVE was not run,
it does nothing.</P>
<P><BR><BR>
</P>
<P>LOCAL: Performs a local fit.</P>
<P>SA: Performs a simulated annealing fit (slower than local).</P>
<P>BI: Performs a Bayesian Inference run (even Slower)</P>
<P><BR><BR>
</P>
<P>Note: the behaviour of some of this algorithms can be altered
editing the &quot;AdvOpt.py&quot; file, but you can mess things up if
you don't know what you are doing.</P>
<P><BR><BR>
</P>
<H3 CLASS="western"><A NAME="1.4.2.The Parameters tab (to be written)|outline"></A>
The Parameters tab (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.3.The Fitting tab (to be written)|outline"></A>
The Fitting tab (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.4.The Results tab (to be written)|outline"></A>
The Results tab (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.5.The Output tab (to be written)|outline"></A>
The Output tab (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.6.Loading a spectrum (to be written)|outline"></A>
Loading a spectrum (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.7.Simulating a spectrum (to be written)|outline"></A>
Simulating a spectrum (to be written)</H3>
<P><BR><BR>
</P>
<H3 CLASS="western"><A NAME="1.4.8.Example 1: fitting a single spectrum. (to be written)|outline"></A>
Example 1: fitting a single spectrum. (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.9.Example 2: Fitting a series of related spectra. (to be written)|outline"></A>
Example 2: Fitting a series of related spectra. (to be written)</H3>
<H3 CLASS="western"><A NAME="1.4.10.Example 3: Use of common parameters. (to be written)|outline"></A>
Example 3: Use of common parameters. (to be written)</H3>
<P><BR><BR>
</P>
<H2 CLASS="western"><A NAME="1.5.Advanced: the text mode user interface.|outline"></A>
Advanced: the text mode user interface.</H2>
<P STYLE="margin-bottom: 0cm">To use PAScual in text mode (advanced,
you need some familiarity with Python syntax), edit PAScual_Input.py
to your needs (better if you do it with the IDLE editor included in
the Python distribution) and then launch it (you can do it from
IDLE). If you have used Melt, you may find it not too different.</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<H2 CLASS="western"><A NAME="1.6.The mathematics|outline"></A>The
mathematics</H2>
<H3 CLASS="western"><A NAME="1.6.1.Model (to be written)|outline"></A>
Model (to be written)</H3>
<H3 CLASS="western"><A NAME="1.6.2.Local Fitting (to be written)|outline"></A>
Local Fitting (to be written)</H3>
<H3 CLASS="western"><A NAME="1.6.3.Simulated Annealing (to be written)|outline"></A>
Simulated Annealing (to be written)</H3>
<H3 CLASS="western"><A NAME="1.6.4.MCMC-BI (to be written)|outline"></A>
MCMC-BI (to be written)</H3>
<H3 CLASS="western"><A NAME="1.6.5.(Rectangular) Tao-Eldrup (to be written)|outline"></A>
(Rectangular) Tao-Eldrup (to be written)</H3>
<H2 CLASS="western"><A NAME="1.7.Things still not implemented|outline"></A>
Things still not implemented</H2>
<P>(to be written)</P>
</BODY>
</HTML>